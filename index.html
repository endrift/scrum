<html>
<head>
<title>Scrum</title>
<base href="../gbajs/">

<link href="../scrum/resources/style.css" rel="stylesheet">
<meta charset="UTF-8"> 

<script src="js/core.js"></script>
<script src="js/arm.js"></script>
<script src="js/thumb.js"></script>
<script src="js/mmu.js"></script>
<script src="js/io.js"></script>
<script src="js/audio.js"></script>
<script src="js/video.js"></script>
<script src="js/video/proxy.js"></script>
<script src="js/video/software.js"></script>
<script src="js/irq.js"></script>
<script src="js/keypad.js"></script>
<script src="js/savedata.js"></script>
<script src="js/gpio.js"></script>
<script src="js/gba.js"></script>
<script src="resources/xhr.js"></script>

<script>
var gba;
var biosLoaded = false;
var gameLoaded = false;
var startGame = false;

try {
	gba = new GameBoyAdvance();
	gba.keypad.eatInput = true;
	gba.setLogger(function(error) {
		console.log(error);
		gba.pause();
	});
} catch (exception) {
	gba = null;
}

function playGame() {
	if (biosLoaded && gameLoaded) {
		gba.runStable();
	} else {
		startGame = true;
	}
}

window.onload = function() {
	if (gba) {
		var canvas = document.getElementById('screen');
		var ctx = canvas.getContext('2d');
		ctx.webkitImageSmoothingEnabled = false;
		ctx.mozImageSmoothingEnabled = false;
		gba.setCanvas(canvas);

		gba.logLevel = gba.LOG_ERROR;
		loadRom('resources/bios.bin', function(bios) {
			gba.setBios(bios);
			if (gameLoaded && startGame) {
				gba.runStable();
			} else {
				biosLoaded = true;
			}
		});
		loadRom('../scrum/resources/scrum.gba', function(game) {
			gba.setRom(game);
			if (biosLoaded && startGame) {
				gba.runStable();
			} else {
				gameLoaded = true;
			}
		});
	}
}
</script>

</head>
<body>
	<div id="content">
		<img src="../scrum/resources/title.png" alt="Scrum" id="title">
		<div id="game">
			<button onclick="playGame(); this.parentElement.removeChild(this)" id="play" class="gamesize">►</button>
			<canvas id="screen" class="gamesize" width="720" height="480"></canvas>
		</div>
		<footer>© 2012 Jeffrey Pfau</footer>
	</div>
</body>
</html>
